from itertools import product

maze = """###############
#.......#....E#
#.#.###.#.###.#
#.....#.#...#.#
#.###.#####.#.#
#.#.#.......#.#
#.#.#####.###.#
#...........#.#
###.#.#####.#.#
#...#.....#.#.#
#.#.#.###.#.#.#
#.....#...#.#.#
#.###.#.#.#.#.#
#S..#.....#...#
###############"""

maze2 = """#################
#...#...#...#..E#
#.#.#.#.#.#.#.#.#
#.#.#.#...#...#.#
#.#.#.#.###.#.#.#
#...#.#.#.....#.#
#.#.#.#.#.#####.#
#.#...#.#.#.....#
#.#.#####.#.###.#
#.#.#.......#...#
#.#.###.#####.###
#.#.#...#.....#.#
#.#.#.#####.###.#
#.#.#.........#.#
#.#.#.#########.#
#S#.............#
#################"""

maze3 = """#############################################################################################################################################
#...#.........................#.......#...#.........#.......#...............#...............................#.......#.....#.......#........E#
#.#.#.#########.#.#.###########.#.###.#.#.#.#####.###.#.#####.#####.#.#####.#####.###.#.###.#.#.#####.#.#.#.#.#.#####.#.###.#.#####.#.#####.#
#.#.#...#.....#...#.#...#.......#.#.....#.#.....#.....#...#...#.....#.#...#...#...#...#.......#.......#.....#.#.......#.#...#.......#.#...#.#
#.#.#.###.###.###.###.#.#.#######.#######.#.###.#.#######.#.###.###.#.#.#.###.#.###.#####.#.#########.#.###.#.#########.#.###########.#.#.###
#.#.#.#...........#...#.#.#...#...#.....#...#...#.#...#...#...#.......#.#.....#.#...#...#.#...#...#.......................#.....#...#...#...#
#.#.#.#.#########.#.###.#.#.#.#.#.#.###.###.#.###.#.#.#.#.###.#.###.#########.#.#.###.#.#.#.#.#.#.#.###.#.###.#######.#.#.#.###.#.#.#######.#
#.#...#...#...#...#...#.....#.#.#.#.#.#.#...#.#...#.#.......................#.....#...#.#...#...#...#...#.....#...................#.......#.#
#.#.#####.#.#.#.#####.#########.#.#.#.#.#.#.#.#.###.#.#.#.#.###.#.#.#######.#####.#.###.###.#.###.###.#######.#.###.#.#.#.#.#.#.#.#######.#.#
#...#...#.....#.................#.#.#.#.#.....#.....#.#.#.#.#.......#.....#.....#...#.#...#.#.....#...#.........#...#.#.....#...#...#...#.#.#
###.###.#####.#####.#####.#.#.#.#.#.#.#.#.#.#####.#####.###.#.#.###.#.###.###.#.#####.###.#.#.#####.###.#####.###.#####.#####.#####.#.#.#.#.#
#...#...#...#.......#.....#.#...#.#.#.#.......#...#.....#...#.#.#...#.#.#...#.#...#...#...#.#.....#.#.#...#.......#.....#.........#.#.#.....#
#.#.#.#.#.#.#########.###.#.#######.#.#.#####.#####.#####.###.###.###.#.###.#####.###.#.###.#####.#.#.###.#.#.#####.###.###########.#######.#
#.....................#...#.........................#...#...#.....#...#.............#.....#.....#.......#.#.#...#...#.......#.....#.....#.#.#
#######.###.###.#.#.#.###########.#.#.#####.#.#.#.###.#.###.#######.###.###.#.#.###.#####.#######.#######.#.#.#.#.#########.#.###.#####.#.#.#
#.................#.#.........#...#...#.....#...#.#...#.....#.....#.#.........#...#.....#.......#.#.#.....#...#.........#...#.#.#.....#.#.#.#
#.#.#.###.#####.###.#.#####.#.#.#####.#.#########.#.#######.#.#.#.#.###.#########.#####.#######.#.#.#.#######.#.#######.###.#.#.#####.#.#.#.#
#.#.#.....#...#.#.#...#...#.#.#.......#.......#...#.#.....#.#.#.#.#...#.#.....#.#.....#.#.....#.#...#...#.....#.......#...#...#.#...#.#.#.#.#
#.#.#######.#.#.#.#####.###.#.###########.#.#.#.###.#.###.#.#.#.#####.###.###.#.#.###.#.#####.#.###.###.###.#########.###.#####.#.#.#.#.#.#.#
#.#.#.......#.#.........#...#.....#...#...#.#.#.#.#...#...#...#...#...#.....#.#.#...#...#.....#...#...#...#.......#...#...#.......#...#.#...#
#.#.#.#######.###########.###.#####.#.#.###.#.#.#.#####.###.#####.#.###.#####.#.#.#.#####.#.#.###.###.###.###.#.###.###.###.#.###.###.#.###.#
#.#...#.....#...........#.....#.....#...#.#.#.#...#...#.#...#...#.#.....#...#.#...#.......#.....#.#.....#...#.#.#...#...#...#.....#.......#.#
#.#####.###.###########.#.#####.#########.#.#.###.#.#.#.#####.#.#.#######.#.#.#####.###.#######.#.#####.###.###.#.#.#.###.###.#.#####.###.#.#
#.......#...#...#.....#...#.....#.....#.....#...#.#.#.#.#...#.#.......#...#.#.....#...#...#.....#.#...#...#...#...#.#...#.#...#.#.........#.#
#.#.#########.#.#.#.#####.#.#####.#####.#######.#.#.#.#.#.#.#.#.#######.###.#####.###.###.#######.#.#.#.#####.#.###.#.#.#.#.###.###.#.#####.#
#.#...#.......#.#.....#...#.#...............#.#...#.#.#...#...#.#.......#.........#.....#.#.....#...#...#...#.....#.#.#.#.#.#.............#.#
#.###.#.#######.#.###.#.###.#.#############.#.#####.#.#######.###.###############.#####.#.#.###.###.###.#.#.#.###.#.#.#.#.#.#.###.###.#.#.###
#.#.#...#.....#...#.#...#...#.#...........#.........#.#...#...#...#.......#...........#.#...#.#.......#.#.#.#.#.#.#...#.#.#.#.#...#.....#...#
#.#.#####.###.#####.#####.#.###.#########.###########.#.#.#.###.###.#####.#.#######.#.#.#####.#.#####.#.#.#.#.#.#.#####.#.###.#.###.#######.#
#.....#.#...#.............#.....#.....#...#...#.....#...#.#...#.....#.....#...#.....#.#...#...#.#.....#...#.#.#.#.......#.#...#...#.#...#...#
#####.#.###.#####.#######.#########.#.#.###.#.#####.#####.###.#######.#######.#.#####.###.###.#.#.#########.#.#.#######.#.#.###.#.#.#.#.#.#.#
#.#...#...#...#...#.....#...#.......#.#...#.#.....#.........#.#.....#...#.#...#.#.....#.#.....#.#...#.#...#...#.......#.....#...#...#.#.#.#.#
#.#.#####.#.###.###.#####.#.#.#.#####.###.#.#####.#.#########.#.###.###.#.#.###.#.#####.#####.#.#.#.#.#.#.#####.#.###.#.#.###.###.#####.#.#.#
#.#.#...#...#...#...#.....#.#.#.#.....#.#...#...#.............#...#.#.#.#.....#.#.....#.....#.#.#...#...#.......#.#.....#...#...#.....#.#.#.#
#.#.#.#.#####.###.###.#.###.#.#.#.#####.#######.###########.#####.#.#.#.#######.#####.#.###.#.#.###.#########.#.#.#########.###.#.###.#.#.###
#.#.#.#.....#...#.....#.....#.#.#.#...............#.#.......#.....#...#.#.....#.....#.#...#.#.#...#.#.........#...#...#...#.#.....#.....#...#
#.#.#.#####.#.#.#########.#####.#.#.#############.#.#.#.###.#.#.#######.#.###.###.#.#.#####.#.###.#.#.#.#######.#.#.#.#.#.#.#.###.#.#######.#
#.#.#...#.#.#.#.....#...#.#.....#...#.....#...#.......#...#.#.#.#.....#...#.....#.#.#.....#.#...#.#...#.#.....#...#.#...#.#.#.#...#.#.......#
#.#.###.#.#.#######.#.#.#.#.#####.###.###.###.#.#########.###.#.#.###.#####.#.###.#.#####.#.###.#.#####.#.###.#.###.#####.#.#.#.#.###.#####.#
#.#.....#...#.....#...#.#...#.......#...#.....#.....#...#...#.#.#...#.......#.....#.....#.#.#...#...#...#.#.#.#...#...#...#.#.#.#...#.....#.#
#.#######.###.###.#####.#####.#.#####.#.#####.#.#.#.#.#.###.#.#.###.###.###.#######.#.#.#.#.#.#####.#####.#.#.#######.#.###.###.#.#.#.###.#.#
#.#...#...#.#...#.......#.....#.#.....#...#...#.#.#...#...#...#.......#...#.#.....#.#.#.#.#.......#.....#...#...........#...#...#...#.#...#.#
#.#.#.#.###.#.#.###.#####.#####.#.#######.#.###.#.#######.#.#######.#####.###.#.#.###.#.#.#.###.#####.#.###.###########.#.###.###.###.#.###.#
#...#.#.#.....#.#.............#.#.....#.#.#.#.#.#...#...#.#.#.....#.#...#.....#.#.#...#.#...#...#...#.#...........#.......#...#.#...#.#...#.#
#.###.#.###.###.###.###.###.#.#######.#.#.#.#.#.###.#.#.#.###.###.###.#.#.#####.#.#.#.#.#.###.#.#.#.###############.#####.#.###.#.#.#.###.#.#
#.#...#...#.#...#...#.#.....#...........#.#...#...#.#.#.......#.#.#...#.....#...#...#...#.....#...#.......#.......#.........#.....#.#...#.#.#
#.#.#####.#.#.#.#.###.###.#.#.#########.#.###.###.#.#.#####.###.#.#.#######.#.#.#########################.#.#.###.#############.#.#.#####.#.#
#...........#.#.............#...#.....#.#...#.#...#.#.#...#.....#...#.....#...#.#.....#.....#.........#...#...#.#.#...#.......#.#...#.....#.#
#.#####.#.###.#.###.#############.###.###.#.###.###.###.#.###.#######.###.#####.#.###.#.###.#.#######.#.###.#.#.#.#.#.#.#####.#.#.###.#####.#
#...#.#.#.....#.#.#.#.#...........#.....#.#...#...#.....#...#.........#...#.....#.#.....#.....#.....#...#.....#.#...#...#.....#...#.....#...#
###.#.#.#######.#.#.#.#.#.###.#.#######.#####.###.###.#####.###.#.#.#####.#.#####.#.###.###.#.###.###.#.#.#####.#####.###.#######.#.###.#####
#...#.#.........#...#.....#.#...#.....#.....#...#...#.....#...#.#...#...#.#.#...#.#.#.....#.#...#.#...#.#.......#.......#.#...#.......#.....#
#.#.#.#######.###.#.#####.#.#.###.###.#####.#.#####.#.#######.#####.#.#.###.#.#.#.#.#.###.#.#.#.#.#.#.#.#####.###.#.#.#.#.#.#.#####.#.#.###.#
#.#.........#...#.........#...#...#...#.......#.....#.#.....#.....#.#.#.....#.#.#.#.#.#.#.#.#.#...#.#.#.....#.#...#...#.#...#.....#...#.#...#
#.###.#####.#.#.#####.#######.#.###.#########.#.#####.#.###.#.###.#.#.#######.#.#.#.#.#.#.###.#.#.#.#.###.#.#.#.#####.#.#.#######.#.###.#.###
#...#.#.......#.#.....#.....#.#.#...#.....#...#...#.#.#...#.#...#.#.#.......#.#.#.#.#.#.#.....#.#...#.....#.#.#.....#.#.#...#.....#.....#...#
###.#.#######.#.#######.###.###.#.#.#.###.#######.#.#.###.#.###.#.#.#.#######.#.#.###.#.#######.#########.#.#.#####.#.#.###.#.#####.###.#.#.#
#...#.#.....#.#.#.......#.#.....#.#.#...#.#.......#...#.......#.#.#...#.......#.#.....#...#.#...#.......#.#.#.....#.#.#.#...#.#.........#.#.#
#.###.#.###.#.#.#.#######.#######.#####.#.#.#######.#.#.#####.###.#.###.#######.#.#####.#.#.#.#.#.#####.#.#.#####.#.#.#.#.###.#.###.#.#.#.#.#
#.#.......#.#.#...#...........#.#.......#...#.....#...#.#.........#...#...#...#.#...#...#...#.#.#.#...#.#...#.#...#.#.#.#.#...#.#...#...#.#.#
#.#########.#.###.###.#.#.###.#.#.#######.#.#####.#.###.#############.###.#.###.###.###.###.#.###.#.#.#.#.###.#.###.#.#.###.###.#.#.###.###.#
#...#.......#...#...#...#...#.#.......#...#...#...#.#.#.....#...#...#.#.#.#.....#.#...#.#...#...#...#.#.#...#.#.#.#.#.....#...#.#.#...#.....#
###.#.#####.###.#.#.#######.#.#####.#.#.#.###.#.###.#.#####.#.#.#.#.#.#.#.#.#####.###.#.#.#####.#.#####.###.#.#.#.#.#####.#.#.#.#.#.#.#.#####
#.#.#.#.#.....#...#.#...#...#...#...#.#...#...#...#.#.....#.#.#...#.#...#.#...#.....#.#.#.#...#...#.......#...#.#.#.....#.#.#.#.#.#.#.......#
#.#.#.#.#.#.#.#####.#.#.#.#####.#.#.#####.#.###.#.#.#.#.#.#.#.###.#.###.#.###.###.#.#.#.#.#.#.#####.#.###.#####.#.#####.#.###.#.#.#.###.###.#
#.#...#.#.#.#...#...#.#...#...#...#.......#.#...#...#.#.#...#...#.#.#...#...#...#.#.#...#.#.#.....#.#...#.#.....#.....#.#...#...............#
#.#####.#.#.###.#.###.#####.#.#.#.#.#######.###.#####.#.#.#####.#.#.#.#####.###.#.###.#####.#####.#.###.#.#.#.#.#.#####.###.#.#.#.###.#.###.#
#.....................#...#.#.#...#.......#...#.#.......#.....#.#.#...#.....#...#.....#.....#...#...#.#.#...#.....#.....#...#.#.#...#.#.#...#
#.#.###.#.#.#.#.#######.###.#.###.#######.###.#.#.#########.###.#.###.#.#####.#########.#####.#.#####.#.###########.#####.###.#####.#.#.#.#.#
#.#.#.#.#...#.#.....#.......#...#.#.#.....#...#...#...#.....#...#...#.#.....#.#.........#.....#.#.....#.#.......#...#.....#.......#...#.#.#.#
#.#.#.#.#.#.#.#####.#.#########.#.#.#.#####.###.###.#.#.#.###.#####.#.#####.#.#.#########.#.###.#.###.#.#.#####.#.###.###.#######.#.###.#.#.#
#.#...#.....#.#...#...#.....#...#...#.#.......#.#...#...#.#...#.#...#.#.....#...#.......#.#.#.#...#.#.#...#...#.#...#.............#.#.....#.#
#.###.###.###.#.#.#.###.#####.#####.#.#.#.###.#.#.#########.###.#.###.###############.#.#.#.#.#####.#.#####.#.#.#.#.#############.#.#.#.#####
#.....#.......#.#...#.#.....#.......#...#...#.#.#.......#...#...#...#...#...........#.#.#.#.#.......#.......#.#.#.#.....#.........#.#.......#
#.#####.#.#####.#####.#.###.#############.###.#.#######.#.###.#.###.###.#######.#.#.###.#.#.#####.###########.#.###.###.###########.###.###.#
#.#...#.#.......#.........#.............#.....#...#...#.#.#...#...#...#.......#.#.#...#.#.#.....#.........#...#...#...#.................#...#
#.#.#.#.#.#######.#######.#####.#.###############.#.#.#.#.###.#######.#######.#.#.###.#.#.#####.#.#####.#.#.#####.###.#####.#############.###
#.#.#.#...#.#.......#...#.#...#.#.........#.........#.#.#...#.......#...#.....#.#.#.#.#.......#.#.#.....#.........#.#...#...............#...#
#.#.#.#.#.#.#.#.#####.#.###.#.#.###.#####.#.#########.#.###.#.#.###.###.#.#######.#.#.#######.#.#.#.#####.###.#####.#.###.#############.#.#.#
#.#.#...#...#.....#...#.....#...#...#...#.......#.....#.#...#.....#.#...#.#.......#.#...#.#...#.#.#.......#...#.......#...#...........#.....#
#.#.###.#.#######.#.#########.#.#.###.#######.#.###.###.#.#######.#.#.###.#.#######.###.#.#.###.#.###.#.###.###.#######.###.#####.#######.#.#
#.#.#...#.........#.#.........#.#...#.......#.#...#...#.#...#.....#.#.#...#.#.....#.....#...#...#...#...#...#...#...#.#...#.....#.#.......#.#
#.#.#.#.#.#######.#.#####.#####.###.#.#.#####.###.#####.###.#.#####.#.#.###.#.###.#.#####.###.#####.#.###.###.###.#.#.###.#.#####.#.#.###.#.#
#.#.#.....#.....#.#.....#.#.......#.#.#.#.....#.....#.....#.#...#...#.#...#.#...#.#.....#.#.#...#.#.#.......#.#...#.#...#.#.......#.#...#.#.#
#.#.#.#.#.#.###.#######.#.###.#.#.#.#.#.#.#########.#.###.#.#.###.#.#.###.#.#.#.#.#####.#.#.###.#.#.###.###.#.#.###.#.#.#.#.#.###.#.#.#.#.#.#
#.#...#.....#.#.#.....#.#...#.#.#.#.#.#.#...#.....#...#.#.#.#.#...#.#.#.#...#.#.......#.#...#...#.#.#...#.#.#...#.#...#.#.#.#.#...#.#.#.#.#.#
#.###.#######.#.#.###.#.###.###.#.#.###.###.#.###.#####.#.#.#.#.#####.#.#.#.#.#####.###.#####.###.#.#.#.#.#.#####.###.#.#.#.#.#.###.#.#.#.#.#
#.#...#...#.......#.#...#.#...#.#.#.....#.#.....#.....#...#.#.#.#.....#.#...#.....#.....#...#...#.#...#...#.#.#.......#...#.#.#.#...#.#.....#
#.#.###.#.#########.#.###.###.#.#######.#.#####.#####.#.###.###.#.#####.#.###########.###.#.###.#.###.#####.#.#.#######.#####.###.###.###.###
#.#...#.#.#.....#.........#...#...........#...#.....#.#...#...#.#.#.......#...#.....#.....#...#.#.....#...#.#...#...#...#.....#...#.........#
#.###.#.#.#.###.#.#.#####.#.#####.#.#####.#.#.###.###.#######.#.#.###.#####.#.#.###.#########.#.#####.#.#.#.#.#####.#.###.#.###.###.#.#####.#
#...#...#.#.#...#.#.....#.#.#.....#.#...#.#.#...#.#...#.........#...#.#.....#.......#.#.....#.#.....#.#.#...#.....#.#.#.#.#...#.#.#.#.......#
###.#####.#.#.###.#####.###.#.###.###.#.###.###.#.#.#.#.###########.#.#.#########.###.#.###.#.#####.#.#.#######.#.#.#.#.#.###.#.#.#.#.#####.#
#...#...#.#.#...#.....#.#.............#...#.#.#.#.#.#.#...#.........#.#.....#.#...#...#.#.#.#.....#.#.#...#.#...#.#.#.#.....#.........#.....#
#.###.#.#.#.###.#######.#.#####.#########.#.#.#.###.###.#.#.#########.#####.#.#.###.#.#.#.#.#####.#.#####.#.#.#.#.#.#.#####.#####.###.###.###
#.#...#.#.....#.......#.#...#.......#...#...#.#.....#...#.#.......#.#.....#...#...#.#.....#.....#...#.....#...#...#.......#.#.......#...#...#
#.###.#.#############.#.###.#.#####.#.#######.#.#####.###.#######.#.#.#####.#####.#.#######.#.#####.#.#####.#######.#####.#.###.#####.#.#####
#.#...#.#.....#.......#.#...#.#...#.#.......#...#...#.....#.....#.....#.....#.....#.....#...#.#.....#.....#.#.......#...#.#...#...#...#.#...#
#.#.###.#.###.#.#######.#.###.#.###.#.###.###.###.#.###.###.#.#.#.#####.#####.#####.###.#.###.#.#########.#.#####.#.#.###.###.###.#.#.#.#.#.#
#...#...#...#.....#...#...#...#...#.#...#.....#.......#.#...#.....#.....#...#.....#.#.......#.#.....#...#.#.....#.#...#...#...#...#.#...#.#.#
#####.###.#.#####.#.#.#.###.###.#.#.#####.#####.#####.#.#.#########.#######.#####.###.#.#.#.#######.###.#.#####.#.#####.###.###.###.#.###.#.#
#.....#...#...#.....#.....#.#...#.#.......#.......#.#...#.........#...........#.#.#...#.#.#.................#...#.#.....#.#.#.#.#.#.#.#...#.#
#.#####.#####.#############.#####.#####.#.#.#####.#.#####.#####.#.###########.#.#.#.###.#.#################.#.###.#.#####.#.#.#.#.#.#.#.###.#
#.#...#.....#.#.................#.#...#.#...#...#.....#.......#.#...........#...#...#...#.........#...#.....#...#.#.#.......#.....#.....#...#
#.###.###.###.#.#######.#######.#.#.#.#######.#.#######.#####.#.#########.#####.#####.#########.#.#.#.#.#######.#.#.###.#################.#.#
#...#.....#...#...#...#...#.......#.#.........#.........#...#.#.....#...#...#...#...#.#.........#...#...#...#.....#...#.........#.....#...#.#
###.#.#####.###.#.#.###.#.###.#####.#####.#################.#.#####.###.###.#.###.#.#.#####.#####.###.###.#.#########.#########.#.###.#.#####
#...#.#...#.........#.......#.#...#.....#.#.......#.........#.#...#.......#.#.#...#.#.....#.....#.#.......#...#.......#.........#...#.#.....#
#.###.#.#############.#.###.###.#.#.###.#.#.#####.#####.#.#.#.#.#.#####.###.#.#.#.#.#####.#####.#.#.#########.#.#######.###########.#.###.#.#
#...#.#.....#...#.....#...#.....#.#.#...#.#.#...#.....#.#.#.#...#.#...#.#...#.#.#...#.....#.....#.....#.....#.#.....#...............#...#.#.#
###.#.#####.#.#.#.#####.#.#####.#.#.#.###.#.###.#####.#.#.#.#####.#.#.#.#.###.#.#.#.#.#.###.#.###.###.#####.#.#.###.#######.###########.###.#
#.#.#.......#.#...#.....#.....#...#.#...#.#.....#.....#.#.......#.#.#...#...#...#.#...#.#...#.....#...#...#...#.#...#...#.........#.#...#...#
#.#.#########.#####.#########.#.#######.###.#####.#####.#######.#.#.#######.#####.#.###.#.#########.###.#.###.###.###.#.#####.###.#.#.###.###
#.#.......#...#.....#.......#.#.......#.....#.....#.....#.....#.#.#.......#...#...#.#...#.....#.......#.#...#...#.....#.....#.#.....#.#.....#
#.#.#####.#.###.#.###.#####.#####.###.###.###.#####.#.#.#.###.###.#.#####.#.#.#.#.#.#.#######.#######.#.###.###.###.#######.#.#.#####.#####.#
#.....#...#.#...#.....#...#.#...#...#...#...#.#.....#.#.#...#.....#.....#.#...#.#...#...#.....#...#...#.#...#.....#.#.......#.#...#...#...#.#
#.#.#.#.###.#.###########.#.#.#.#.#.###.###.#.#####.#.#####.###########.#.#.#.#.#.#####.#.#.###.#.#.###.#.#######.###.###.###.###.#.###.#.#.#
#...#.#.....#.....#.....#.#...#...#.#...#.#.#.#...#.#.......#.#...........#.#.#.#.#.#.....#.....#.#...#.#.....#.......#.......#...#.#...#...#
#.#.#############.###.#.#.#########.#.###.#.#.#.#.#.###.###.#.#.#.#######.#.###.#.#.#.###########.###.#.#####.###########.#.#######.#.#.###.#
#.#...#.........#.....#.......#...#...#.....#...#.#...#...#.#.....#.....#.#.#...#.#...#.........#.#...#.#...#.........#...#.#...#...#.#.#...#
#.#.#.#.#.###.###############.###.#####.#########.###.###.#.#####.#.###.###.#.###.#.###.###.#####.#.###.###.#########.#.#####.#.#.###.#.###.#
#...#.#.#...#.#.........#.....#...#.....#.......#.#...#...#.#...#...#.#...#.#.#.......#.#.#.......#...............#...#.....#.#.#.#.#.#...#.#
#####.#.#.###.#.#######.#.#####.#.#.#########.#.#.#.###.#.#.#.#.###.#.###.#.#.#.#####.#.#.#############.#########.#.#.#####.#.#.#.#.#.###.#.#
#.....#.#...#...#.....#...#.....#.....#.......#...#.#...#.#...#.....#...#...#.#.#...#.#.....#.........#.#.......#.#.#.......#.#...#.....#.#.#
#.#.#.#.#.#.#####.###.#######.#.#####.#.#########.###.#####.#########.#.#.###.#.#.#.#######.#.#######.#.#.#####.###.#.#.#.###.###########.#.#
#.#.#.#.#.#.#.....#.....#...#.#.....#.#.........#...#.......#.......#.#.#.#...#...#.....#...#...#...#.#.#.....#.....#.#.#.#...#...#.......#.#
#.#.#.#.#.#.#.###.#.###.#.#.#####.#.#.#.#######.###.#####.#.#.#####.#.###.#.#########.###.###.#.#.###.#.#####.#######.#.#.#.###.#.#.#######.#
#.#...#.#.#.......#...#...#.#...#.#...#.......#...#.....#.#...#...#.#.....#.........#.....#...#.#.....#.#...#...#.....#.#.#.....#.#.....#...#
#.###.#.#.#######.###.#####.#.#.#.#.#############.#####.#.#.###.#.#.#.###.#########.###########.#.#######.#.#.#.#.#####.#########.#####.#.#.#
#.#...#.....#.......................#.......#.........#.#.#.#...#.#.#...#.#...#...#.....#.....#.....#...#.........................#.....#...#
#.#.#.###.#.#.###.#.###.#######.#.#.#.#####.#.#.#######.###.#.###.#.#.#.#.#.###.#.#####.#.###.#.###.#.#.#.###.#.###.#.#.#.###.#.###.#########
#...#.#...#.#...#...#...#.......#.#...#.#.....#.#.....#.#...#.#.#.#...#.#...#...#.....#.#...#...#...#.#.#.#...#.#.#.#.#.#.#.#...#.....#.....#
#.#.###.#.#.#.###.###.#.#.#######.#.###.#.#######.###.#.#.#.#.#.#.###.#.#####.###.#.###.#.#.#####.###.#.#.#.#.#.#.#.#.#.#.#.#######.#.#.###.#
#.................#.........#.......#.......#.........#.......#.....#.#.....#.....#.....#.#.#...#.#...#...#...#.#.#...#...#.......#.#...#...#
###.#.###.#####.###.#.#.###.#.#####.#######.#.#####.#######.#######.#.#####.#####.#######.#.###.#.#.#.#######.#.#.###.#####.#.###.#######.#.#
#...#.#.#.....#.#.....#.#...#.#...#.....#...#...#.#.#.....#.#.....#.......#.......#...#...#...#.#.#.#...#...#...#...#.#.....#...............#
#.#.#.#.#.#.#.#.#.#####.#.#####.#.#.###.#######.#.#.#.###.###.###.#.#.#####.###.#.#.#.#######.#.#.#####.#.###.#####.#.#########.###.#######.#
#.#...#...#.#.#.#.#...#...#.......................#...#...#...#.#.#.#...#...#.#.#.#.#.............#...#.#...........#.#...#...#.#.....#...#.#
#.#.#####.#.#.#.#.###.#####.#####.#.#.#######.#.#.#####.###.###.#.###.#.#.###.#.#.#.#.#.###.#.#.###.#.#.#.###.#######.#.#.#.#.#.#.###.#.#.#.#
#S..........#...#...........#.......#...........#...........#.........#...#.....#...#...#.....#.....#...#...............#...#...#...#...#...#
#############################################################################################################################################"""

g = maze.split('\n')

def find_pos(ch):
    for i, row in enumerate(g):
        if ch in row:
            return i, row.index(ch)

start = find_pos('S')
goal = find_pos('E')
dir = '>'

# print(start, goal)



opposite = {'<': '>',
            '>': '<',
            '^': 'v',
            'v': '^'}

move = {'<': (0, -1),
            '>': (0, 1),
            '^': (-1, 0),
            'v': (1, 0)}

def neighbors(state):
    r = set()
    pos, dir = state
    x, y = pos
    dx, dy = move[dir]
    if g[x + dx][y + dy] in '.E':
        r.add(((x + dx, y + dy), dir))
    for d in '<>^v':
        if d != dir and not d == opposite[dir]:
            r.add((pos, d))
    return r

def distance(start, goal):
    seen = {start}
    frontier =  {start}
    progress = True
    cost = {start: 0}
    while progress:
        progress = False
        new_frontier = set()
        for state in frontier:
            for n in neighbors(state):
                step_cost = 1 if state[1] == n[1] else 1000
                if n in seen and cost[state] + step_cost >= cost[n]:
                    continue
                progress = True
                cost[n] = cost[state] + step_cost
                new_frontier.add(n)
                seen.add(n)
        frontier = new_frontier

    r = (min([cost[(goal, d)] for d in '<>^v']))
    return r, cost

path = set()

dist, cost_from_start = distance((start, '>'), goal)
for  d in '<>^v':
    dist2, cost_from_goal = distance((goal, d), start)

    for k, v in cost_from_start.items():
        pos, dir = k
        sum_costs = v + cost_from_goal[(pos, opposite[dir])]
        assert sum_costs >= dist
        if sum_costs == dist:
            path.add(pos)

print(len(path))
